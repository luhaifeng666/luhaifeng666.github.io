<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Webpack学习笔记六：css兼容性处理以及文件提取 | 酱豆腐精的小站</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://luhaifeng666.github.io/favicon.ico?v=1640359067064">
<link rel="stylesheet" href="https://luhaifeng666.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="上一节我们学习到webpack中如何处理css文件，以及在使用了 css预处理器 后又改怎么处理。文章末尾我们也提到了两个需要解决的问题：


随着项目推进，一直将css写入js中会导致文件逐渐臃肿；
css兼容性
这一节，我们将针对这两个..." />
    <meta name="keywords" content="学习" />
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://luhaifeng666.github.io">
        <img src="https://luhaifeng666.github.io/images/avatar.png?v=1640359067064" class="site-logo">
        <h1 class="site-title">酱豆腐精的小站</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      我吹，你听
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/luhaifeng666" target="_blank">酱豆腐精</a> | <a class="rss" href="https://luhaifeng666.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Webpack学习笔记六：css兼容性处理以及文件提取</h2>
            <div class="post-date">2021-12-24</div>
            
              <div class="feature-container" style="background-image: url('https://luhaifeng666.github.io/post-images/webpack-xue-xi-bi-ji-liu-css-jian-rong-xing-chu-li-yi-ji-wen-jian-ti-qu.jpeg')">
              </div>
            
            <div class="post-content" v-pre>
              <p><a href="https://juejin.cn/post/6905647041368555527">上一节</a>我们学习到webpack中如何处理css文件，以及在使用了 <code>css预处理器</code> 后又改怎么处理。文章末尾我们也提到了两个需要解决的问题：</p>
<blockquote>
<ol>
<li>随着项目推进，一直将css写入js中会导致文件逐渐臃肿；</li>
<li>css兼容性<br>
这一节，我们将针对这两个问题提出相应的解决方案。</li>
</ol>
</blockquote>
<h1 id="css文件提取">css文件提取</h1>
<p>上一节中我们使用到了 <code>style-loader</code> 、 <code>css-loader</code> 以及 <code>sass-loader</code> 三种loader，在这三种loader的协同作用下，.scss文件先通过sass-loader转成普通的css文件，再通过css-loader将css转换成commonjs模块并打包到js中，最后通过style-loader将js文件中的css样式加载到head里的style标签中去。<br><br>
除了上面提到的第一个问题外，这样也会导致页面会有短暂的错乱，然后等js文件加载完成后，页面样式才会恢复正常，这显然不符合我们的要求，用户的体验也非常不好。此时，我们需要将js中的css单独提取出来，作为css文件引入页面，这样就可以解决这个问题。而且js的文件体积会更小，上述第一个问题也能被解决。</p>
<h2 id="如何使用">如何使用</h2>
<p>要将js中的css提取成单独的文件，我们需要用到一个 <code>插件</code> ：<code>mini-css-extract-plugin</code>。</p>
<h3 id="安装">安装</h3>
<pre><code class="language-js">yarn add -D mini-css-extract-plugin
</code></pre>
<h3 id="配置">配置</h3>
<p>前几节我们主要使用的是webpack中的 <code>loader</code> ，与 <code>loader</code> 不同的是，<code>插件</code> 在使用之前需要先引入进来，然后在wbepack.config.js的 <code>plugin</code> 字段中添加配置：</p>
<pre><code class="language-js">const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
    /* ... */
    plugins: [
    	new MiniCssExtractPlugin({
         filename: 'css/index.[contenthash:10].css',
       }),
    ]
    /* ... */
}
</code></pre>
<p>其中，在实例化这个插件时，可以传入配置。上述配置中指定了提取出css文件的输出路径。<br><br>
在配置完插件之后，我们来回顾一下之前的处理方式，最终的结果是<strong>通过 <code>style-loader</code> 将css的内容插入到页面的style标签中</strong>。而现在我们要实现的是<strong>将css文件单独提取出来</strong>。所以我们需要将 <code>style-loader</code> 替换掉。<br><br>
在 <code>mini-css-extract-plugin</code> 插件内部提供了一个用于提取css的loader: <code>MiniCssExtractPlugin.loader</code>，我们只需要将 <code>style-loader</code> 替换为 <code>MiniCssExtractPlugin.loader</code> 即可：</p>
<pre><code class="language-js">const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
    /* ... */
    module: {
        rules: [
            /* ... */
            {
              test: /\.s[ac]ss/,
              exclude: /(node_modules|build)/,
              use: [
                MiniCssExtractPlugin.loader,,
                'css-loader',
                'sass-loader'
              ],
            },
        ]
    },
    plugins: [
    	new MiniCssExtractPlugin({
         filename: 'css/index.[contenthash:10].css',
       }),
    ]
    /* ... */
}
</code></pre>
<h1 id="css兼容性处理">css兼容性处理</h1>
<p>在日常开发中，为了让css样式能够适用于大多数的设备或者浏览器，我们需要对css做好兼容性处理。<br><br>
css的兼容性处理需要用到 <a href="https://www.postcss.com.cn/">postcss</a>。 <code>postcss</code> 是一个用 JavaScript 工具和插件转换 CSS 代码的工具。在webpack中使用它需要用到两个包：<code>postcss-loader</code> 以及 <code>postcss-preset-env</code>。<br><br>
其中，<code>postcss-preset-env</code> 的作用是帮助 <code>postcss-loader</code> 找到 <code>browserslist</code> 的配置，加载指定的兼容性。<code>browserslist</code> 一般会配置到package.json下，或者在根目录下有一个 <code>.browserslistrc</code> 的文件去写相关的配置。</p>
<blockquote>
<p>注意：package.json中的配置与.browserslistrc文件，两者只能存其一，否则会报错！！</p>
</blockquote>
<h3 id="安装-2">安装</h3>
<pre><code class="language-js">yarn add -D postcss-loader postcss-preset-env
</code></pre>
<h3 id="配置-2">配置</h3>
<p>我们在上面的loader配置基础上进行一些修改：</p>
<pre><code class="language-js">{
  test: /\.s[ac]ss$/i,
  use: [
    MiniCssExtractPlugin.loader,
    'css-loader',
    {
      loader: 'postcss-loader',
      options: {
        postcssOptions: {
          plugins: [
            [
              'postcss-preset-env',
              {
                // Options
              },
            ],
          ],
        },
      }
    },
    // 将 Sass 编译成 CSS
    'sass-loader',
  ],
},
</code></pre>
<p>然后在 <code>package.json</code> 文件中添加如下配置（更多配置可以参考:<a href="https://github.com/browserslist/browserslist">browserslist</a>）：</p>
<pre><code class="language-json">&quot;browserslist&quot;: {
    &quot;development&quot;: [ // 开发环境
      &quot;last 1 chrome version&quot;,
      &quot;last 1 safari version&quot;,
      &quot;last 1 firefox version&quot;
    ],
    &quot;production&quot;: [ // 生产环境
      &quot;&gt; 0.2%&quot;,
      &quot;not dead&quot;,
      &quot;not op_mini all&quot;
    ]
}
</code></pre>
<p>或者也可以在根目录下创建.browserslistrc文件。</p>
<blockquote>
<p>注意：配置项是有顺序的！！&gt; 0.2%写到后面会报错</p>
</blockquote>
<pre><code class="language-json">&gt; 0.2%
not dead
not op_mini all
</code></pre>
<p>关于postcss-loader更多的配置可以<a href="https://webpack.js.org/loaders/postcss-loader/#root">参考</a>。</p>
<h1 id="css文件压缩">css文件压缩</h1>
<p>在对css文件做完兼容性处理并提取成单个文件之后，我们可以进一步对其进行优化，将抽出的css文件进行压缩。此时我们需要用到一个插件： <code>optimize-css-assets-webpack-plugin</code>。</p>
<h3 id="安装-3">安装</h3>
<pre><code class="language-js">yarn add -D optimize-css-assets-webpack-plugin
</code></pre>
<h3 id="使用">使用</h3>
<p>使用非常简单 ，只需要在 <code>webpack.config.js</code> 中引入使用即可。默认配置已经可以满足压缩需要，如果需要添加配置，可以<a href="https://www.npmjs.com/package/optimize-css-assets-webpack-plugin">参考</a>。</p>
<pre><code class="language-js">const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
    /* ... */
    module: {
      rules: [
        /* ... */
        {
          test: /\.s[ac]ss$/i,
          use: [
            MiniCssExtractPlugin.loader,
            'css-loader',
            {
              loader: 'postcss-loader',
              options: {
                postcssOptions: {
                  plugins: [
                    [
                      'postcss-preset-env',
                      {
                        // Options
                      },
                    ],
                  ],
                },
              }
            },
            // 将 Sass 编译成 CSS
            'sass-loader',
          ],
        },
      ]
    },
    plugins: [
    	new MiniCssExtractPlugin({
         filename: 'css/index.[contenthash:10].css',
       }),
       new OptimizeCssAssetsWebpackPlugin()
    ]
    /* ... */
}
</code></pre>
<h1 id="预告">预告</h1>
<p>通过这两节，我们已经知道了webpack中如何对css文件进行处理，并在此过程中对其做了一些优化，包括提取单个css文件，兼容性处理以及css代码压缩。<br><br>
下一节我们一起来看下，除了css文件与js文件外，其他的文件webpack要如何进行处理呢？拭目以待吧~</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://luhaifeng666.github.io/tag/grwpKLl9t/" class="tag">
                    学习
                  </a>
                
              </div>
            
            <div id="vcomments"></div>
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://luhaifeng666.github.io/post/webpack-xue-xi-bi-ji-qi-qi-ta-wen-jian-de-da-bao/">
                  <h3 class="post-title">
                    Webpack学习笔记七：其他文件的打包
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script type="text/javascript">
      // 设置valine
      new Valine({
        el: '#vcomments',
        appId: 'zYWibXSnGWE9VHeQWDPXrJIF-gzGzoHsz',
        appKey: 'qsFJvfKHzCIlBAzfJRaJEJRF'
      })
    </script>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
